<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>O Poder do Dedo - Responsivo 16:9 e 9:16</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-storage-compat.js"></script>

  <!-- QRCode lib -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <style>
    /* Reset básico */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body, html {
      width: 100%; 
      height: 100%;
      background: #f0f0f0;
      font-family: Arial, sans-serif;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* Contêiner que força proporção 16:9 no modo normal */
    #mainContainer {
      width: 100%;
      max-width: 1400px; /* limite para TV grande */
      margin: 0 auto;
      aspect-ratio: 16 / 9;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }

    /* Se estiver em modo retrato (celular) */
    @media (orientation: portrait) {
      #mainContainer {
        aspect-ratio: 9 / 16; /* travamos 9:16 */
      }
    }

    /* Área scroll interna */
    #contentScroll {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    h1 {
      text-align: center;
      margin: 10px 0;
    }
    .hidden {
      display: none !important;
    }

    /* Botões */
    button {
      padding: 10px 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      margin: 5px 0;
      transition: background 0.2s;
    }
    button:hover {
      opacity: 0.9;
    }
    .btn-success { background: #28a745; color: #fff; }
    .btn-danger { background: #dc3545; color: #fff; }
    .btn-warning { background: #ffc107; color: #212529; }
    .btn-info    { background: #17a2b8; color: #fff; }
    .btn-primary { background: #007bff; color: #fff; }
    .btn-dark    { background: #555; color: #fff; }

    /* Sessões internas */
    .section {
      background: #fafafa;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
    }

    .title {
      font-weight: bold;
      margin-bottom: 8px;
      text-align: center;
      font-size: 1.1rem;
      color: #444;
    }

    /* Campos de texto */
    input[type="text"], 
    input[type="number"] {
      width: 100%;
      padding: 8px;
      margin: 6px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    /* Chat e Painel */
    .panel-box {
      background: #f9f9f9;
      border: 1px solid #ccc;
      border-radius: 6px;
      max-height: 150px;
      overflow-y: auto;
      padding: 8px;
      margin-top: 8px;
    }
    /* Regras */
    .rules-box {
      background: #f9f9f9;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 8px;
      min-height: 60px;
    }
    /* Cartas e Deck */
    .card-front {
      width: 100px; 
      height: 140px;
      border: 2px solid #000;
      border-radius: 6px;
      background: #fff;
      margin: 0 auto;
      position: relative;
      color: #000;
    }
    .card-rank-suit {
      position: absolute; 
      top: 8px; left: 8px;
      font-size: 1.4rem; 
      font-weight: bold;
    }
    .card-back {
      width: 15px; 
      height: 25px;
      background: #bbb;
      border-radius: 3px;
      display: inline-block;
      margin: 2px;
    }
    .red { color: red; }
    .black { color: #000; }

    /* Layout flex interno para host e player */
    .flex-row {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: space-between;
    }

    .status-panel {
      background: #e7f3ff;
      border: 1px solid #bee0ff;
      border-radius: 6px;
      padding: 10px;
      text-align: center;
      font-weight: bold;
      color: #007BFF;
      margin-bottom: 10px;
    }

    .finger-box {
      background: #fffce6;
      border: 1px solid #e0d975;
      border-radius: 6px;
      padding: 10px;
      margin: 10px 0;
    }

    /* Overlay de vídeo */
    #videoOverlay {
      position: fixed;
      top:0; left:0;
      width:100%; height:100%;
      background: rgba(0,0,0,0.8);
      color: #fff;
      display: none;
      flex-direction: column;
      align-items:center;
      justify-content:center;
      z-index:9999;
      padding:10px;
    }
    video {
      background:#000; 
      max-width:90vw; 
      max-height:60vh;
    }

    /* Acomoda rolagem no container */
    #contentScroll::-webkit-scrollbar {
      width: 6px;
    }
    #contentScroll::-webkit-scrollbar-thumb {
      background-color: #ccc;
      border-radius: 3px;
    }
  </style>
</head>

<body>
  <div id="mainContainer">
    <div id="contentScroll">
      <h1>O Poder do Dedo</h1>

      <!-- Aqui vem toda a estrutura do Host e do Jogador, igual ao anterior -->
      
      <!-- MODO SELETOR -->
      <div id="modeSelect">
        <div class="section">
          <div class="title">Você é o Organizador ou Jogador?</div>
          <button id="btnHost" class="btn-dark">Organizador</button>
          <button id="btnPlayer" class="btn-primary">Jogador</button>
        </div>
      </div>

      <!-- HOST AREA -->
      <div id="hostArea" class="hidden">
        <div id="hostStep1" class="section">
          <div class="title">Criar ou Entrar numa Partida</div>
          <button id="btnCreateGame" class="btn-success">Criar Nova Partida</button>
          <p style="margin-top:10px;text-align:center;">Ou entre numa partida:</p>
          <input type="text" id="inputGameCodeHost" placeholder="Código" />
          <button id="btnJoinGameHost" class="btn-info">Entrar</button>
        </div>

        <div id="hostLobby" class="hidden section">
          <div class="title">Lobby da Partida</div>
          <p>Código: <span id="hostGameCode"></span></p>
          <div style="text-align:center;">
            <div id="qrCodeLobby"></div>
            <p id="hostLinkInfo" style="margin-top:5px;font-size:0.9rem;"></p>
          </div>
          <h4>Jogadores Conectados</h4>
          <div id="hostPlayersList"></div>
          <button id="btnStartGame" class="btn-primary" style="margin-top:10px;">Iniciar Partida</button>
        </div>

        <div id="hostGame" class="hidden section">
          <div id="hostStatusPanel" class="status-panel"></div>
          <div style="text-align:center;margin-bottom:10px;" id="qrCodeGame"></div>

          <h4>Carta Atual</h4>
          <div id="currentCardHost">Nenhuma</div>
          <button id="btnDrawCard" class="btn-warning" style="margin-top:10px;">
            &#x1F0CF; Puxar Carta
          </button>

          <h4 style="margin-top:15px;">Baralho</h4>
          <div id="deckCount"></div>
          <div id="deckView"></div>

          <h4 style="margin-top:15px;">Regras Ativas</h4>
          <div id="hostRules" class="rules-box"></div>

          <h4 style="margin-top:15px;">Jogadores</h4>
          <div id="hostPlayersStatus"></div>

          <h4 style="margin-top:15px;">Painel (Eventos)</h4>
          <div id="hostPainel" class="panel-box"></div>

          <h4>Chat</h4>
          <div id="hostChat" class="panel-box"></div>
          <input type="text" id="hostChatInput" placeholder="Digite uma mensagem..." />
          <button id="btnHostSendChat" class="btn-info">Enviar</button>

          <button id="btnEndGame" class="btn-danger" style="margin-top:10px;">Encerrar Partida</button>
        </div>
      </div>

      <!-- PLAYER AREA -->
      <div id="playerArea" class="hidden">
        <div id="playerStep1" class="section">
          <div class="title">Entrar Numa Partida</div>
          <input type="text" id="inputGameCodePlayer" placeholder="Código..." />
          <button id="btnEnterCodePlayer" class="btn-info">Entrar</button>
          <p style="margin-top:10px;font-size:0.8rem;text-align:center;">ou use o link/QR code</p>
        </div>

        <div id="playerRegister" class="hidden section">
          <div class="title">Digite Seu Nome</div>
          <input type="text" id="inputPlayerName" placeholder="Seu nome" />
          <button id="btnJoinPlayerGame" class="btn-success" style="margin-top:8px;">Entrar na Partida</button>
        </div>

        <div id="playerLobby" class="hidden section">
          <div class="title">Aguardando Organizador Iniciar...</div>
          <div id="playerLobbyList"></div>
        </div>

        <div id="playerGame" class="hidden section">
          <div id="playerStatusPanel" class="status-panel hidden"></div>

          <h4>Carta Atual</h4>
          <div id="currentCardPlayer">Nenhuma</div>
          <button id="btnDrawCardPlayer" class="btn-warning" style="display:none;margin-top:8px;">
            &#x1F0CF; Puxar Carta
          </button>

          <h4 style="margin-top:15px;">Baralho</h4>
          <div id="deckCountPlayer"></div>
          <div id="deckViewPlayer"></div>

          <h4 style="margin-top:15px;">Regras Ativas</h4>
          <div id="playerRules" class="rules-box"></div>

          <h4 style="margin-top:15px;">Jogadores</h4>
          <div id="playerListStatus"></div>

          <div class="finger-box hidden" id="fingerBox">
            <h4>Poder do Dedo Ativo!</h4>
            <p>Seja rápido para não perder!</p>
            <button id="btnFingerClick" class="btn-danger" style="margin-top:5px;">Clicar Agora</button>
            <div id="fingerQueue" style="margin-top:5px;"></div>
          </div>

          <div style="text-align:center;">
            <button id="btnUseJoker" class="btn-info" style="display:none;">Usar Coringa</button>
            <button id="btnActivateFinger" class="btn-warning" style="display:none;">Poder do Dedo (8)</button>
            <button id="btnRecordVideo" class="btn-dark">Gravar Vídeo</button>
          </div>

          <!-- Overlay de Vídeo -->
          <div id="videoOverlay">
            <video id="videoPreview" autoplay muted playsinline></video>
            <div style="margin-top:10px;">
              <button id="btnStartRecording" class="btn-success">Iniciar</button>
              <button id="btnStopRecording" class="btn-danger">Parar</button>
              <button id="btnCloseVideoOverlay" class="btn-dark">Fechar</button>
            </div>
          </div>

          <h4 style="margin-top:15px;">Painel (Eventos)</h4>
          <div id="playerPainel" class="panel-box"></div>

          <h4>Chat</h4>
          <div id="playerChat" class="panel-box"></div>
          <input type="text" id="playerChatInput" placeholder="Digite uma mensagem..." />
          <button id="btnPlayerSendChat" class="btn-info">Enviar</button>
        </div>
      </div>
    </div><!-- contentScroll -->
  </div><!-- mainContainer -->

<script>
/* 
   AQUI VEM TODO O CÓDIGO DE LÓGICA DO JOGO (Host e Player) 
   Exatamente como no exemplo anterior. 
   Basta copiar o script do "final" que fizemos, mas com as 
   referências para esses elementos de layout. 
*/

/* ...Cole a lógica anterior (createGameAsHost, subscribeHost, updatePlayerView, etc.)... */
/* EXATAMENTE igual, só mudando os IDs conforme este layout. */
/* MANTER localStorage, chat, e etc. */
</script>
</body>
</html>
